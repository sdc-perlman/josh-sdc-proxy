(()=>{"use strict";var e={n:n=>{var t=n&&n.__esModule?()=>n.default:()=>n;return e.d(t,{a:t}),t},d:(n,t)=>{for(var r in t)e.o(t,r)&&!e.o(n,r)&&Object.defineProperty(n,r,{enumerable:!0,get:t[r]})},o:(e,n)=>Object.prototype.hasOwnProperty.call(e,n)};const n=require("path");var t=e.n(n);const r=require("express");var a=e.n(r);const o=require("request");var i=e.n(o);const s=require("@babel/runtime/helpers/asyncToGenerator");var c=e.n(s);const l=require("@babel/runtime/regenerator");var p=e.n(l);const d=require("dotenv");e.n(d)().config({path:t().join(__dirname,"../",".env")});var u=function(e){return function(){var n=c()(p().mark((function n(t,r){var a,o;return p().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:"/"!==e.slice(-1)&&(e+="/"),a=t.params.id,o={method:"GET",uri:"".concat(e).concat(a)},i()(o,(function(e,n,t){if(e)return console.log(e),r.sendStatus(500),e;r.json(JSON.parse(t))}));case 5:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}()},m=u(process.env.WORKSPACE),v=u(process.env.AMENITIES),g=u(process.env.TRANSIT),f=u(process.env.ADDRESS),b=u(process.env.NEARBY_BUILDINGS),h=u(process.env.REVIEWS),w=u(process.env.REVIEW_INFO),y=u(process.env.DESCRIPTION),E=u(process.env.PHOTOS),k=u(process.env.PHOTOS_BY_WORKSPACE);const S={address:f,amenities:v,availability:function(){var e=c()(p().mark((function e(n,t){var r,a;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.query.id,a={method:"GET",uri:"".concat(process.env.AVAILABILITY,"/?id=").concat(r)},i()(a,(function(e,n,r){if(e)return console.log(e),t.sendStatus(500),e;t.json(JSON.parse(r))}));case 3:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),description:y,nearbyBuildings:b,photos:E,photosByWorkspace:k,reviews:h,reviewInfo:w,transit:g,workspace:m},T=require("fs");var A=e.n(T);const x=require("react");var N=e.n(x);const I=require("react-dom/server");var L=e.n(I);const q=require("@babel/runtime/helpers/slicedToArray");var O=e.n(q);const B=require("mapbox-gl");var P=e.n(B);const C=require("@babel/runtime/helpers/taggedTemplateLiteral");var R=e.n(C);const _=require("styled-components");var z,W=e.n(_),M=W().div(z||(z=R()(["\n  #map {\n    height: 320px;\n    width: 100%;\n    margin: 2rem 0;\n  }\n\n  .marker {\n    width: 10px;\n    height: 10px;\n    background-color: #000;\n    border: #000 4px solid;\n    border-radius: 50%;\n    opacity: 0.99;\n  }\n\n  .marker.nearby {\n    background-color: transparent;\n    border: blue 4px solid;\n  }\n\n  .building-link {\n    line-height: 20px;\n    height: 100%;\n    width: 137.8px;\n    color: blue;\n    font-size: 16px;\n    text-align: center;\n    text-decoration: none;\n    appearance: none;\n    background: none;\n    border: 0;\n    padding: 0;\n    outline: none;\n  }\n\n  .building-link:hover {\n    text-decoration: underline\n  }\n"])));const j=function(e){var n=e.locationData,t=n.origin,r=n.nearbyWorkspaces,a=t.geometry.coordinates;return(0,x.useEffect)((function(){P().accessToken=process.env.KEY;var e=new(P().Map)({container:"map",style:"mapbox://styles/christulin/ckkvmm2w448sw17nv9a3cwuqm",center:a,zoom:11}),n=document.createElement("div");n.className="marker",new(P().Marker)(n).setLngLat(a).addTo(e).setLngLat(a).setPopup(new(P().Popup)({offset:25,closeButton:!1}).setHTML("<h3>"+t.streetNumber+" "+t.streetName+"</h3>")).addTo(e),r&&r.forEach((function(n){var t=document.createElement("div");t.className="marker nearby",new(P().Marker)(t).setLngLat(n.geometry.coordinates).addTo(e).setLngLat(n.geometry.coordinates).setPopup(new(P().Popup)({offset:25,closeButton:!1}).setHTML('<a class="building-link" href=/buildings/'.concat(n.workspaceId,">")+n.streetNumber+" "+n.streetName+"</a>")).addTo(e)}));var o=new(P().NavigationControl)({showCompass:!1});e.addControl(o,"top-left")})),N().createElement(M,null,N().createElement("div",{id:"map"}))},D=require("@fortawesome/react-fontawesome");var H,U,Y,F=W().li(H||(H=R()(["\n  margin-bottom: 1rem;\n  font-size: 16px;\n  display: flex;\n  align-items: flex-start;\n"]))),G=W().div(U||(U=R()(["\n  width: 36px;\n  height: 36px;\n"]))),K=W().div(Y||(Y=R()(["\n  margin-left: 1.25rem;\n"])));const V=function(e){var n=e.option,t=e.type;return N().createElement(F,null,N().createElement(G,null,N().createElement(D.FontAwesomeIcon,{icon:t,size:"lg"})),N().createElement(K,null,n.name," ",n.type))},J=require("@fortawesome/free-solid-svg-icons");var Q,X,Z=W().ul(Q||(Q=R()(["\n  list-style-type: none;\n  margin: 0;\n  padding: 0;\n  "]))),$=W().div(X||(X=R()(["\n  .transit-title {\n    text-transform: uppercase;\n    margin-bottom: 1.5rem;\n    font-size: 16px;\n  }\n"])));const ee=function(e){var n=e.nearbyTransits,t={metro:J.faTrain,bus:J.faBus,"bike path":J.faBicycle,freeway:J.faRoad};return N().createElement(N().Fragment,null,N().createElement($,null,N().createElement("p",{className:"transit-title"},"NEARBY TRANSIT")),N().createElement(Z,null,n.map((function(e,n){return N().createElement(V,{key:n,option:e,type:t[e.type]})}))))},ne=function(){var e=(0,x.useState)({origin:{rawAddress:"4011 S Central Ave, Los Angeles, CA 90011, USA",coordinates:[34.0105442,-118.2569161],formattedAddress:"4011 S Central Ave, Los Angeles, CA 90011, USA",streetName:"South Central Avenue",streetNumber:"4011",neighborhood:"South Los Angeles",city:"Los Angeles",state:"CA",country:"United States",countryCode:"US",zipcode:"90011",_id:"604997d783f12ac5bbc6a059",geometry:{type:"Point",coordinates:[-118.2569161,34.0105442],_id:"604997d783f12ac5bbc6a05a"},workspaceId:1,workspaceSlug:"waistcoat-shabby",workspace:"6016623df463365dd660f3bb",__v:0}}),n=O()(e,2),t=n[0],r=(n[1],(0,x.useState)([])),a=O()(r,2),o=a[0],i=a[1],s=t.origin,c=s.streetName,l=s.streetNumber,p=s.city,d=s.state,u=s.zip;return(0,x.useEffect)((function(){var e=window.location.pathname.split("/").filter((function(e){return e})),n=e[e.length-1];fetch("/api/getNearbyTransitOptions/".concat(n)).then((function(e){return e.json()})).then((function(e){var n=e.nearbyTransitOptions;i(n)}))}),[]),N().createElement("div",{className:"map-wrapper"},N().createElement("h2",{style:{fontSize:"2rem",fontWeight:"600",lineHeight:"2.75rem",marginBottom:"1rem"}},"Location"),N().createElement("address",{style:{whiteSpace:"pre-line",marginBottom:"2rem",fontSize:"16px",fontStyle:"normal",lineHeight:"1.5rem"}},l," ",c,N().createElement("br",null),p,", ",d," ",u),N().createElement(j,{locationData:t}),N().createElement(ee,{nearbyTransits:o}))},te=function(e,n){var r=L().renderToString(N().createElement(ne,null)),a=t().resolve("./public/index.html");A().readFile(a,"utf8",(function(e,t){return e?(console.error("Something went wrong:",e),n.status(500).send("Something went wrong")):n.send(t.replace('<div id="location-service"></div>','<div id="location-service">'.concat(r,"</div>")))}))};var re=a()();re.get("/",te),re.get("/buildings/:workspaceId",te),re.get("/workspace-api/workspace/:id",S.workspace),re.get("/amenities-api/amenity/:id",S.amenities),re.get("/api/workspace-description/:id",S.description),re.get("/api/photos/:id",S.photos),re.get("/api/photos/workspace/:id",S.photosByWorkspace),re.get("/api/availability",S.availability),re.get("/api/getNearbyTransitOptions/:id",S.transit),re.get("/api/nearbyworkspaces/buildings/:id",S.nearbyBuildings),re.get("/api/nearbyworkspaces/address/:id",S.address),re.get("/api/reviews/all/:id",S.reviews),re.get("/api/reviews/info/:id",S.reviewInfo);var ae=process.env.PORT?process.env.PORT:6002;re.listen(ae,(function(){console.log("listening on port ".concat(ae))}))})();