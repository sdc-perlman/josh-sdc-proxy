(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=require("path");var n=e.n(t);const r=require("express");var a=e.n(r);const o=require("request");var i=e.n(o);const s=require("@babel/runtime/helpers/asyncToGenerator");var c=e.n(s);const l=require("@babel/runtime/regenerator");var p=e.n(l);const d=require("dotenv");e.n(d)().config({path:n().join(__dirname,"../",".env")});var u=function(e){return function(){var t=c()(p().mark((function t(n,r){var a,o;return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:"/"!==e.slice(-1)&&(e+="/"),a=n.params.id,o={method:"GET",uri:"".concat(e).concat(a)},i()(o,(function(e,t,n){if(e)return console.log(e),r.sendStatus(500),e;r.json(JSON.parse(n))}));case 5:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},m=u(process.env.WORKSPACE),g=u(process.env.AMENITIES),v=u(process.env.TRANSIT),f=u(process.env.ADDRESS),y=u(process.env.NEARBY_BUILDINGS),h=u(process.env.REVIEWS),w=u(process.env.REVIEW_INFO),b=u(process.env.DESCRIPTION),S=u(process.env.PHOTOS),E=u(process.env.PHOTOS_BY_WORKSPACE);const k={address:f,amenities:g,availability:function(){var e=c()(p().mark((function e(t,n){var r,a;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.query.id,a={method:"GET",uri:"".concat(process.env.AVAILABILITY,"/?id=").concat(r)},i()(a,(function(e,t,r){if(e)return console.log(e),n.sendStatus(500),e;n.json(JSON.parse(r))}));case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),description:b,nearbyBuildings:y,photos:S,photosByWorkspace:E,reviews:h,reviewInfo:w,transit:v,workspace:m},N=require("fs");var T=e.n(N);const I=require("react");var A=e.n(I);const x=require("react-dom/server");var _=e.n(x);const q=require("styled-components");var C=e.n(q);const L=require("@babel/runtime/helpers/slicedToArray");var O=e.n(L);const B=require("mapbox-gl");var P=e.n(B),R=C().div.withConfig({displayName:"styles__Wrapper",componentId:"c0pkp9-0"})(["#map{height:320px;width:100%;margin:2rem 0;}.marker{width:10px;height:10px;background-color:#000;border:#000 4px solid;border-radius:50%;opacity:0.99;}.marker.nearby{background-color:transparent;border:blue 4px solid;}.building-link{line-height:20px;height:100%;width:137.8px;color:blue;font-size:16px;text-align:center;text-decoration:none;appearance:none;background:none;border:0;padding:0;outline:none;}.building-link:hover{text-decoration:underline}"]);const W=function(e){var t=e.locationData,n=t.origin,r=t.nearbyWorkspaces,a=n.geometry.coordinates;return(0,I.useEffect)((function(){P().accessToken=process.env.KEY;var e=new(P().Map)({container:"map",style:"mapbox://styles/christulin/ckkvmm2w448sw17nv9a3cwuqm",center:a,zoom:11}),t=document.createElement("div");t.className="marker",new(P().Marker)(t).setLngLat(a).addTo(e).setLngLat(a).setPopup(new(P().Popup)({offset:25,closeButton:!1}).setHTML("<h3>"+n.streetNumber+" "+n.streetName+"</h3>")).addTo(e),r&&r.forEach((function(t){var n=document.createElement("div");n.className="marker nearby",new(P().Marker)(n).setLngLat(t.geometry.coordinates).addTo(e).setLngLat(t.geometry.coordinates).setPopup(new(P().Popup)({offset:25,closeButton:!1}).setHTML('<a class="building-link" href=/buildings/'.concat(t.workspaceId,">")+t.streetNumber+" "+t.streetName+"</a>")).addTo(e)}));var o=new(P().NavigationControl)({showCompass:!1});e.addControl(o,"top-left")})),A().createElement(R,null,A().createElement("div",{id:"map"}))},z=require("@fortawesome/react-fontawesome");var D=C().li.withConfig({displayName:"styles__Item",componentId:"sc-1w6dtv-0"})(["margin-bottom:1rem;font-size:16px;display:flex;align-items:flex-start;"]),M=C().div.withConfig({displayName:"styles__Image",componentId:"sc-1w6dtv-1"})(["width:36px;height:36px;"]),j=C().div.withConfig({displayName:"styles__Description",componentId:"sc-1w6dtv-2"})(["margin-left:1.25rem;"]);const H=function(e){var t=e.option,n=e.type;return A().createElement(D,null,A().createElement(M,null,A().createElement(z.FontAwesomeIcon,{icon:n,size:"lg"})),A().createElement(j,null,t.name," ",t.type))},U=require("@fortawesome/free-solid-svg-icons");var Y=C().ul.withConfig({displayName:"styles__List",componentId:"sc-1828qsm-0"})(["list-style-type:none;margin:0;padding:0;"]),F=C().div.withConfig({displayName:"styles__Wrapper",componentId:"sc-1828qsm-1"})([".transit-title{text-transform:uppercase;margin-bottom:1.5rem;font-size:16px;}"]);const G=function(e){var t=e.nearbyTransits,n={metro:U.faTrain,bus:U.faBus,"bike path":U.faBicycle,freeway:U.faRoad};return A().createElement(A().Fragment,null,A().createElement(F,null,A().createElement("p",{className:"transit-title"},"NEARBY TRANSIT")),A().createElement(Y,null,t.map((function(e,t){return A().createElement(H,{key:t,option:e,type:n[e.type]})}))))},K=function(){var e=(0,I.useState)({origin:{rawAddress:"4011 S Central Ave, Los Angeles, CA 90011, USA",coordinates:[34.0105442,-118.2569161],formattedAddress:"4011 S Central Ave, Los Angeles, CA 90011, USA",streetName:"South Central Avenue",streetNumber:"4011",neighborhood:"South Los Angeles",city:"Los Angeles",state:"CA",country:"United States",countryCode:"US",zipcode:"90011",_id:"604997d783f12ac5bbc6a059",geometry:{type:"Point",coordinates:[-118.2569161,34.0105442],_id:"604997d783f12ac5bbc6a05a"},workspaceId:1,workspaceSlug:"waistcoat-shabby",workspace:"6016623df463365dd660f3bb",__v:0}}),t=O()(e,2),n=t[0],r=(t[1],(0,I.useState)([])),a=O()(r,2),o=a[0],i=a[1],s=n.origin,c=s.streetName,l=s.streetNumber,p=s.city,d=s.state,u=s.zip;return(0,I.useEffect)((function(){var e=window.location.pathname.split("/").filter((function(e){return e})),t=e[e.length-1];fetch("/api/getNearbyTransitOptions/".concat(t)).then((function(e){return e.json()})).then((function(e){var t=e.nearbyTransitOptions;i(t)}))}),[]),A().createElement("div",{className:"map-wrapper"},A().createElement("h2",{style:{fontSize:"2rem",fontWeight:"600",lineHeight:"2.75rem",marginBottom:"1rem"}},"Location"),A().createElement("address",{style:{whiteSpace:"pre-line",marginBottom:"2rem",fontSize:"16px",fontStyle:"normal",lineHeight:"1.5rem"}},l," ",c,A().createElement("br",null),p,", ",d," ",u),A().createElement(W,{locationData:n}),A().createElement(G,{nearbyTransits:o}))},V=function(e,t){var r=new q.ServerStyleSheet,a=_().renderToString(r.collectStyles(A().createElement(K,null))),o=r.getStyleTags(),i=n().resolve("./public/index.html");T().readFile(i,"utf8",(function(e,n){return e?(console.error("Something went wrong:",e),t.status(500).send("Something went wrong")):(n=(n=n.replace('<div id="location-service"></div>','<div id="location-service">'.concat(a,"</div>"))).replace('<style id="ssr"></style>',o),t.send(n))}))};var J=a()();J.get("/",V),J.get("/buildings/:workspaceId",V),J.get("/workspace-api/workspace/:id",k.workspace),J.get("/amenities-api/amenity/:id",k.amenities),J.get("/api/workspace-description/:id",k.description),J.get("/api/photos/:id",k.photos),J.get("/api/photos/workspace/:id",k.photosByWorkspace),J.get("/api/availability",k.availability),J.get("/api/getNearbyTransitOptions/:id",k.transit),J.get("/api/nearbyworkspaces/buildings/:id",k.nearbyBuildings),J.get("/api/nearbyworkspaces/address/:id",k.address),J.get("/api/reviews/all/:id",k.reviews),J.get("/api/reviews/info/:id",k.reviewInfo);var Q=process.env.PORT?process.env.PORT:6002;J.listen(Q,(function(){console.log("listening on port ".concat(Q))}))})();